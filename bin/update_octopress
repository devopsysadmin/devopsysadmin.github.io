#!/bin/sh
if [ `basename $PWD` = bin ]; then cd .. ; fi
HERE=$PWD
mkdir -p $HERE/octopress

if [ -d $HERE/octopress/code ]; then
	cd $HERE/octopress/code
	GIT=$(git pull)
	echo "$GIT"
	UPDATED=$(echo $GIT | grep -ci already)
else
	git clone https://github.com/imathis/octopress.git $HERE/octopress/code
	UPDATED=0
fi

# Git says it's already up-to-date, so...
if [ $UPDATED -eq 1 ]; then exit ; fi

# Yay, New stuff!
rsync -aS $HERE/octopress/code/ $HERE/octopress/updated/ \
	--exclude=.git* \
	--exclude=_config.yml \
	--exclude=*.markdown


rsync -aS --delete-before $HERE/octopress/updated/plugins/ $HERE/plugins/
rsync -aS $HERE/octopress/updated/ $HERE/

cd $HERE
bundle install --path .bundle
